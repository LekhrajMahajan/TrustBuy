import{c as j,u as M,s as E,a as T,r as c,j as e,l as L,t as u,v as R}from"./index-D8nFeV_V.js";import{A as _}from"./arrow-left-BkC98y2P.js";import{L as $}from"./lock-FbGTNH-_.js";import{T as v}from"./truck-BKU-IpIU.js";import{S as q}from"./shield-check-DzAsKj6J.js";const O=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],A=j("credit-card",O);const U=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],z=j("qr-code",U);const H=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],V=j("wallet",H),W=()=>{const{user:x}=M(),{cartItems:m,totalPrice:N,clearCart:w}=E(),h=T(),[t,C]=c.useState("card"),[y,f]=c.useState(!1),p=Number(N)||0,[r,S]=c.useState({number:"",name:"",expiry:"",cvv:""}),[b,D]=c.useState(""),[o,P]=c.useState("");if(c.useEffect(()=>{m.length===0&&h("/")},[m,h]),m.length===0)return null;const g=s=>{const{name:a,value:i}=s.target;let l=i;a==="number"?l=i.replace(/\D/g,"").substring(0,16).replace(/(\d{4})/g,"$1 ").trim():a==="expiry"?l=i.replace(/\D/g,"").substring(0,4).replace(/(\d{2})(\d{1,2})/,"$1/$2"):a==="cvv"&&(l=i.replace(/\D/g,"").substring(0,3)),S({...r,[a]:l})},k=()=>t==="cod"?!0:t==="card"?r.number.length>=19&&r.name.length>0&&r.expiry.length===5&&r.cvv.length===3:t==="upi"?o.length>5&&!o.includes("@")||b.includes("@")&&b.length>3:!1,I=async s=>{if(s.preventDefault(),!k()){u.error("Incomplete Details");return}f(!0);try{let a={status:"COMPLETED",update_time:new Date().toISOString(),email_address:x?.email||"guest@trustbuy.com"};t==="card"?(a.id=`TXN-CARD-${Date.now()}`,a.card_last4=r.number.slice(-4)):t==="upi"?(a.id=o,a.upi_id=b,a.taxCode=o):t==="cod"&&(a.id=`COD-${Date.now()}`,a.status="PENDING");const i={orderItems:m.map(l=>({product:l._id,name:l.name,image:l.image,price:l.currentPrice,qty:l.qty})),shippingAddress:{address:x?.address||"123 Main St",city:x?.city||"Mumbai",postalCode:x?.pincode||"400001",country:"India"},paymentMethod:t,paymentResult:a,totalPrice:p,isPaid:t!=="cod"};await R.createOrder(i),u.success("Order Placed Successfully"),setTimeout(()=>{f(!1),w(),h("/orders")},1e3)}catch(a){console.error("Payment Error:",a),f(!1);const i=a.response?.data?.message||"Payment Failed. Please try again.";u.error(i),a.response&&a.response.status===401&&(u.error("Session Expired. Redirecting to Login..."),setTimeout(()=>{localStorage.removeItem("userInfo"),localStorage.removeItem("token"),window.location.href="/login"},1500))}},d="w-full border-b border-gray-200 dark:border-white py-3 text-sm text-black dark:text-white focus:border-black dark:focus:border-white focus:outline-none bg-transparent dark:bg-black placeholder:text-gray-300 transition-colors font-medium",n="block text-[10px] font-bold uppercase tracking-widest text-gray-500 dark:text-gray-400 mb-1";return e.jsx("div",{className:"min-h-screen bg-white dark:bg-gray-900 pt-24 pb-12",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-12 border-b border-black dark:border-white pb-6 flex flex-col md:flex-row md:items-end justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>h("/cart"),className:"flex items-center text-xs font-bold uppercase tracking-widest text-gray-400 hover:text-black dark:hover:text-white mb-4 transition-colors",children:[e.jsx(_,{className:"w-3 h-3 mr-2"})," Return to Cart"]}),e.jsx("h1",{className:"text-4xl md:text-5xl font-extrabold uppercase tracking-tighter text-black dark:text-white",children:"Secure Checkout"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-widest text-green-600",children:[e.jsx($,{className:"w-3 h-3"})," Encrypted Transaction"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-12",children:[e.jsxs("div",{className:"lg:col-span-8",children:[e.jsx("div",{className:"flex border-b border-gray-100 dark:border-gray-800 mb-8",children:[{id:"card",label:"Credit Card",icon:A},{id:"upi",label:"UPI / QR",icon:z},{id:"cod",label:"Cash on Delivery",icon:v}].map(s=>e.jsxs("button",{onClick:()=>C(s.id),className:`flex items-center gap-2 px-6 py-4 text-xs font-bold uppercase tracking-widest transition-all relative ${t===s.id?"text-black dark:text-white":"text-gray-400 hover:text-gray-600 dark:text-gray-400"}`,children:[e.jsx(s.icon,{className:"w-4 h-4"}),s.label,t===s.id&&e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-black dark:bg-gray-800"})]},s.id))}),e.jsxs("div",{className:"min-h-[400px]",children:[t==="card"&&e.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-2 duration-500",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-12",children:[e.jsx("div",{className:"order-2 md:order-1",children:e.jsxs("div",{className:"bg-black dark:bg-black border border-transparent dark:border-white text-white dark:text-white aspect-[1.58/1] rounded-xl p-6 flex flex-col justify-between shadow-2xl relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white dark:bg-gray-900/10 rounded-full blur-2xl -mr-10 -mt-10"}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"w-10 h-6 border border-white/30 rounded flex items-center justify-center text-[8px] font-bold tracking-widest",children:"CHIP"}),e.jsx("span",{className:"font-mono text-xs opacity-50",children:"DEBIT / CREDIT"})]}),e.jsxs("div",{className:"space-y-4 relative z-10",children:[e.jsx("div",{className:"font-mono text-xl tracking-widest",children:r.number||"0000 0000 0000 0000"}),e.jsxs("div",{className:"flex justify-between text-[10px] uppercase tracking-widest opacity-70",children:[e.jsx("span",{children:r.name||"Card Holder"}),e.jsx("span",{children:r.expiry||"MM/YY"})]})]})]})}),e.jsxs("div",{className:"order-1 md:order-2 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Card Number"}),e.jsx("input",{type:"text",name:"number",placeholder:"0000 0000 0000 0000",maxLength:"19",className:`${d} font-mono`,value:r.number,onChange:g})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Card Holder"}),e.jsx("input",{type:"text",name:"name",placeholder:"NAME ON CARD",className:d,value:r.name,onChange:g})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Expiry"}),e.jsx("input",{type:"text",name:"expiry",placeholder:"MM/YY",maxLength:"5",className:`${d} font-mono`,value:r.expiry,onChange:g})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"CVC"}),e.jsx("input",{type:"password",name:"cvv",placeholder:"123",maxLength:"3",className:`${d} font-mono`,value:r.cvv,onChange:g})]})]})]})]})}),t==="upi"&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-2 duration-500 max-w-lg",children:[e.jsx("h3",{className:"text-xl font-bold uppercase tracking-tight mb-6",children:"Scan to Pay"}),e.jsxs("div",{className:"flex gap-8 items-start",children:[e.jsx("div",{className:"p-2 border border-black dark:border-white inline-block",children:e.jsx("img",{src:"https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=upi://pay",alt:"QR",className:"w-32 h-32 mix-blend-multiply"})}),e.jsxs("div",{className:"flex-1 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:n,children:"UPI ID"}),e.jsx("input",{type:"text",placeholder:"user@bank",className:d,value:b,onChange:s=>D(s.target.value.trim())})]}),e.jsxs("div",{children:[e.jsx("label",{className:n,children:"Transaction Ref (UTR)"}),e.jsx("input",{type:"text",placeholder:"12 Digit UTR Number",className:d,value:o,onChange:s=>P(s.target.value)}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"Enter the reference number from your payment app."})]})]})]})]}),t==="cod"&&e.jsxs("div",{className:"animate-in fade-in slide-in-from-bottom-2 duration-500 py-12 border border-dashed border-gray-300 text-center",children:[e.jsx(v,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-bold uppercase tracking-tight",children:"Cash on Delivery"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm max-w-sm mx-auto mt-2",children:["Pay exactly ",e.jsxs("span",{className:"text-black dark:text-white font-bold",children:["₹",p.toLocaleString("en-IN")]})," upon delivery within 2-3 days. Please ensure someone is available at the address."]})]})]})]}),e.jsx("div",{className:"lg:col-span-4",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-950 p-8 sticky top-24 border border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 border-b border-gray-200 dark:border-gray-700 pb-4",children:[e.jsx("h3",{className:"text-sm font-bold uppercase tracking-widest text-black dark:text-white",children:"Order Summary"}),e.jsx(V,{className:"w-4 h-4 text-gray-400"})]}),e.jsxs("div",{className:"space-y-4 mb-8",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Subtotal"}),e.jsxs("span",{className:"font-mono font-bold",children:["₹",p.toLocaleString("en-IN")]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Shipping"}),e.jsx("span",{className:"font-mono font-bold text-black dark:text-white",children:"FREE"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Taxes"}),e.jsx("span",{className:"font-mono font-bold text-gray-400",children:"INCLUDED"})]})]}),e.jsxs("div",{className:"flex justify-between items-end pt-6 border-t border-black dark:border-white mb-8",children:[e.jsx("span",{className:"text-sm font-bold uppercase tracking-widest",children:"Total Due"}),e.jsxs("span",{className:"text-3xl font-extrabold tracking-tight",children:["₹",p.toLocaleString("en-IN")]})]}),e.jsxs("button",{onClick:I,disabled:y||!k(),className:"w-full py-4 bg-black dark:bg-black border border-transparent dark:border-white text-white dark:text-white text-xs font-bold uppercase tracking-widest hover:bg-[#fdc600] hover:text-black dark:hover:text-yellow transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg flex items-center justify-center gap-2",children:[y?"Processing...":t==="cod"?"Place Order":"Pay Now",!y&&e.jsx(L,{className:"w-4 h-4"})]}),e.jsxs("div",{className:"mt-6 flex justify-center gap-4 opacity-50 grayscale",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{className:"text-[10px] font-bold uppercase tracking-widest mt-0.5",children:"Secure SSL Encrypted"})]})]})})]})]})})};export{W as default};
